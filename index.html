<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مؤسسة الصالحي</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="header">
    <img src="logo.png" alt="شعار المؤسسة" class="logo">
    <h1>مؤسسة الصالحي للدعم والتميّز</h1>
  </div>

  <div class="container">
    <div class="introduction">
      <p>
        مرحباً بكم في مؤسسة الصالحي، حيث نسعى جاهدين لتقديم أفضل دعم تعليمي وتربوي لأبنائكم. هدفنا هو تمكين كل تلميذ من تحقيق أقصى إمكاناته، وتجاوز الصعوبات الدراسية، وبناء مستقبل مشرق من خلال مسيرة دراسية ناجحة.
      </p>
    </div>
    
    <div class="quick-features">
      <h2>ميزات سريعة</h2>
      <div class="features-container">
        <div class="feature-card" onclick="openScheduleModal()">
          <div class="icon">📅</div>
          <h3>جدول الحصص</h3>
          <p>اطلع على جدول الحصص الأسبوعي</p>
        </div>
        <div class="feature-card" onclick="openLoginModal('lessons')">
          <div class="icon">📚</div>
          <h3>ملفات الدروس</h3>
          <p>ادخل للاطلاع على ملخصات وتمارين الدروس</p>
        </div>
        <div class="feature-card" onclick="openLoginModal('tests')">
          <div class="icon">🏆</div>
          <h3>اختبر معلوماتك</h3>
          <p>شارك في اختباراتنا وتنافس على المراتب الأولى</p>
        </div>
        <div class="feature-card" onclick="openLoginModal('contact')">
          <div class="icon">✉️</div>
          <h3>الاتصال بالإدارة</h3>
          <p>سجّل دخولك لإرسال رسالة مباشرة</p>
        </div>
      </div>
    </div>
    
    <div class="links">
      <a href="login.html">دخول الأولياء</a>
      <a href="login.html?admin=1">خاص بالإدارة</a>
    </div>

    <div id="general-announcements-section" class="announcements-container" style="display: none;">
      <h2>📢 إعلانات هامة 📢</h2>
      <ul id="announcements-list" class="announcements-list-styled">
        </ul>
    </div>

    <div id="top-students-section" class="top-students-container" style="display: none;"> <h2>🏆 متفوقو الأسبوع 🏆</h2>
      <p class="subtitle">نحتفي هذا الأسبوع بطلابنا المتميزين الذين أظهروا تفوقًا ملحوظًا. تهانينا لهم!</p>
      <div id="top-students-list" class="cards-container">
        </div>
    </div>

    </div>

  <div class="footer">
    <p>حقوق النشر © 2025 الصالحي — جميع الحقوق محفوظة</p>
  </div>

  <div id="modal-backdrop" class="modal-backdrop" onclick="closeModal()"></div>
  <div id="modal" class="modal">
    <button class="modal-close-btn" onclick="closeModal()">×</button>
    <div id="modal-content">
      </div>
  </div>

  <div id="schedule-content" style="display: none;">
    <h2>جدول الحصص العام</h2>
    <div class="table-responsive">
      <table id="schedule-table-popup" class="timetable">
        <thead>
          <tr>
            <th>التوقيت</th>
            <th>الإثنين</th>
            <th>الثلاثاء</th>
            <th>الأربعاء</th>
            <th>الخميس</th>
            <th>الجمعة</th>
            <th>السبت</th>
            <th>الأحد</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script src="guardian_script.js"></script> <script src="schedule_script.js"></script>
  <script>
    const modal = document.getElementById('modal');
    const modalBackdrop = document.getElementById('modal-backdrop');
    const modalContent = document.getElementById('modal-content');

    function openModal(content, modalClass = '') {
      modalContent.innerHTML = content;
      modal.className = 'modal'; 
      if (modalClass) modal.classList.add(modalClass);
      modal.style.display = 'block';
      modalBackdrop.style.display = 'block';
    }

    function closeModal() {
      modal.style.display = 'none';
      modalBackdrop.style.display = 'none';
      modalContent.innerHTML = '';
    }

    function openScheduleModal() {
      const scheduleHTML = document.getElementById('schedule-content').innerHTML;
      openModal(scheduleHTML, 'modal-lg');
      buildSchedule("schedule-table-popup");
    }

    async function handleLogin(event, target) {
      event.preventDefault();
      const form = event.target;
      const phone = form.querySelector('input[type="text"]').value;
      const password = form.querySelector('input[type="password"]').value;
      const errorEl = form.querySelector('.error-message');
      errorEl.textContent = '';
      
      if (password === 'aymenstam') {
        sessionStorage.setItem("admin", "true");
        if (target === 'lessons') {
          window.location.href = 'lessons.html';
        } else if (target === 'tests') { // تحديث هنا
          window.location.href = 'tests.html';
        } else if (target === 'contact') {
          window.open('https://m.me/770223689507881', '_blank');
          closeModal();
        }
        return;
      }
      try {
        const guardian = await guardianLogin(phone, password);
        if (guardian) {
          sessionStorage.setItem("guardian", JSON.stringify(guardian));
          if (target === 'lessons') {
            window.location.href = 'lessons.html';
          } else if (target === 'tests') { // تحديث هنا
            window.location.href = 'tests.html';
          } else if (target === 'contact') {
            window.open('https://m.me/770223689507881', '_blank');
            closeModal();
          }
        } else {
          errorEl.textContent = 'رقم الهاتف أو كلمة السر غير صحيحة.';
        }
      } catch (err) {
        errorEl.textContent = 'حدث خطأ. الرجاء المحاولة مرة أخرى.';
        console.error(err);
      }
    }

    function openLoginModal(target) {
      let loginTitle = '';
      if (target === 'lessons') {
        loginTitle = 'الاطلاع على ملفات الدروس';
      } else if (target === 'contact') {
        loginTitle = 'الاتصال بالإدارة';
      } else if (target === 'tests') { // تحديث هنا
        loginTitle = 'الدخول للاختبارات التفاعلية';
      }

      const loginHTML = `
        <h2>${loginTitle}</h2>
        <p>الرجاء تسجيل الدخول أولاً للمتابعة.</p>
        <form onsubmit="handleLogin(event, '${target}')">
          <input type="text" placeholder="رقم هاتف الولي" required>
          <input type="password" placeholder="كلمة السر" required>
          <button type="submit">دخول</button>
          <p class="error-message" style="color:red;"></p>
        </form>
      `;
      openModal(loginHTML);
    }

    document.addEventListener('DOMContentLoaded', async () => {
        const section = document.getElementById('general-announcements-section');
        const listContainer = document.getElementById('announcements-list');

        try {
            const response = await fetch('announcements.json');
            if (!response.ok) return;

            const announcements = await response.json();

            if (announcements && announcements.length > 0) {
                listContainer.innerHTML = '';
                announcements.forEach(announcement => {
                    const card = document.createElement('div');
                    card.className = 'announcement-card';
                    card.innerHTML = `
                        <h3>${announcement.text}</h3>
                        <p class="date">${announcement.date}</p>
                    `;
                    listContainer.appendChild(card);
                });
                section.style.display = 'block';
            }
        } catch (error) {
            console.error('Error fetching general announcements:', error);
        }
    });

    document.addEventListener('DOMContentLoaded', async () => {
      const section = document.getElementById('top-students-section');
      const listContainer = document.getElementById('top-students-list');
      const colors = ['gold', 'silver', 'bronze'];
      try {
        const response = await fetch('top_students.json');
        if (!response.ok) return;

        const topStudentsData = await response.json();

        // التحقق إذا كانت البيانات عبارة عن قائمة طلاب
        if (Array.isArray(topStudentsData) && topStudentsData.length > 0) {
          listContainer.innerHTML = '';
          topStudentsData.forEach((student, index) => {
            const card = document.createElement('div');
            const colorClass = colors[index % colors.length];
            card.className = `student-card ${colorClass}`;
            card.innerHTML = `
              <h3>${student.name}</h3>
              <p class="level">${student.level}</p>
              <p class="reason">"${student.reason}"</p>
            `;
            listContainer.appendChild(card);
          });
          section.style.display = 'block';
        } 
        // التحقق إذا كانت البيانات نصًا (مثل رسالة التحديث)
        else if (typeof topStudentsData === 'string') {
          listContainer.innerHTML = `<p style="text-align: center; font-size: 1.2em; color: #555; padding: 20px;">${topStudentsData}</p>`;
          section.style.display = 'block';
        }
        // في حالة كانت القائمة فارغة أو البيانات غير متوقعة، لن يظهر القسم

      } catch (error) {
        console.error('Error fetching top students:', error);
      }
    });
    });
  </script>
</body>
</html>

